<!DOCTYPE html>
<html lang="zxx">

<head>

    <!--CAPTCHA-->
    <script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback2&render=explicit" async defer></script>
</head>

<body>

    <!--******************** Inicio de MODULO **************-->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Cotiza</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <form id="formularioModal">
                        <input type="text" name="nameModal1" placeholder="Nombre" required>
                        <input type="email" name="emailModal1" placeholder="Email" required>
                        <input type="tel" name="telefono" placeholder="Teléfono">                       
                        <input id="producto-cotizado" type="text" name="subjectModal1" placeholder="Asunto" required>
                        <textarea name="messageModal1" placeholder="Mensaje"></textarea>
                        <div id="recaptchaID" class="g-recaptcha mb-3"></div>
                        <button type="button" class="appao-btn appao-btn2" data-dismiss="modal">Cancelar</button>
                        <button type="submit" class="appao-btn appao-btn-ea">Enviar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!--******************** fin de MODULO **************-->

    <script>
        
        //se verifica recaptcha del modal de mantenimiento y el de producto
        var captchaResponse;
        var verifyCallback2 = function (response) {
            captchaResponse = response;
            console.log("La verifiacion del recaptcha es: ");
        };

        //cargando los recaptcha del modal de mantenimiento y el de productos
        var onloadCallback2 = function () {
            respuestaCaptcha2 = grecaptcha.render('recaptchaID', {
                'sitekey': '6LfO6KEUAAAAANK3EauCKGq4DmSZMdpCPd_Z4zMX',
                'callback': verifyCallback2,
            });
            console.log("recaptcha cotiza:  " + respuestaCaptcha2);
        };


        //inicio del envio de info del formulario del mantenimiento
        var formularioModal = document.getElementById('formularioModal');

        formularioModal.addEventListener('submit', function (e) {
            e.preventDefault();
            var datosModal = new FormData(formularioModal);
            console.log(datosModal)
            console.log(datosModal.get('nameModal1'))
            console.log(datosModal.get('emailModal1'))
            console.log(datosModal.get('subjectModal1'))
            console.log(datosModal.get('messageModal1'))
            datosModal.append('recaptchaResponse', captchaResponse);
            fetch('./formulario-modal.php', {
                method: 'POST',
                body: datosModal
                
            })

                .then(res => res.json())
                .then(data => {
                    console.log(data)
                    if (data === 'error') {
                        alert("Ingrese todos los campos y el recaptcha");
                        if (respuestaCaptcha2 != undefined) {
                            grecaptcha.reset(respuestaCaptcha2);  //limpia el recaptcha  
                        }
                    } else if (data === 'erro') {
                        alert("No se valido correctamente el recaptcha ");
                        grecaptcha.reset(respuestaCaptcha2);  //limpia el recaptcha  
                    } else {
                        alert(data);
                        // Limpiar el formulario
                        $('input').val("");//todos los inputs quedarán vacíos ;)
                        $('textarea').val("");//todos los textarea quedarán vacíos ;)
                        grecaptcha.reset(respuestaCaptcha2);  //limpia el recaptcha  
                    }
                })
        })
        //fin del envio de info del formulario del mantenimiento

    </script>

</body>

</html>